<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Excel User Defined Functions with C# and ExcelDna | Hugo Quick Start Site</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Adding user defined functions to Excel can be laborious, either you use VBA or COM. Why can&rsquo;t Microsoft make it easier to use Visual Studio and .NET within Excel?
Enter ExcelDna.
This example creates a static function in C# using Visual Studio. There is documentation that already describes this, what I am adding is:
Use Visual Studio to create project
Post Build Events to help create the final XLL file.">
    <meta name="generator" content="Hugo 0.121.2">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="https://example.org/2012/06/excel-user-defined-functions-with-c-and_58.html">
    

    <meta property="og:title" content="Excel User Defined Functions with C# and ExcelDna" />
<meta property="og:description" content="Adding user defined functions to Excel can be laborious, either you use VBA or COM. Why can&rsquo;t Microsoft make it easier to use Visual Studio and .NET within Excel?
Enter ExcelDna.
This example creates a static function in C# using Visual Studio. There is documentation that already describes this, what I am adding is:
Use Visual Studio to create project
Post Build Events to help create the final XLL file." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://example.org/2012/06/excel-user-defined-functions-with-c-and_58.html" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-06-13T05:35:00-07:00" />
<meta property="article:modified_time" content="2012-06-13T05:35:00-07:00" />

<meta itemprop="name" content="Excel User Defined Functions with C# and ExcelDna">
<meta itemprop="description" content="Adding user defined functions to Excel can be laborious, either you use VBA or COM. Why can&rsquo;t Microsoft make it easier to use Visual Studio and .NET within Excel?
Enter ExcelDna.
This example creates a static function in C# using Visual Studio. There is documentation that already describes this, what I am adding is:
Use Visual Studio to create project
Post Build Events to help create the final XLL file."><meta itemprop="datePublished" content="2012-06-13T05:35:00-07:00" />
<meta itemprop="dateModified" content="2012-06-13T05:35:00-07:00" />
<meta itemprop="wordCount" content="403">
<meta itemprop="keywords" content=".Net,MS Excel," /><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Excel User Defined Functions with C# and ExcelDna"/>
<meta name="twitter:description" content="Adding user defined functions to Excel can be laborious, either you use VBA or COM. Why can&rsquo;t Microsoft make it easier to use Visual Studio and .NET within Excel?
Enter ExcelDna.
This example creates a static function in C# using Visual Studio. There is documentation that already describes this, what I am adding is:
Use Visual Studio to create project
Post Build Events to help create the final XLL file."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Hugo Quick Start Site
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">Excel User Defined Functions with C# and ExcelDna</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2012-06-13T05:35:00-07:00">June 13, 2012</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>Adding user defined functions to Excel can be laborious, either you use VBA or COM. Why can&rsquo;t Microsoft make it easier to use Visual Studio and .NET within Excel?</p>
<p>Enter <a href="http://exceldna.codeplex.com/" title="ExcelDna on CodePlex">ExcelDna</a>.</p>
<p>This example creates a static function in C# using Visual Studio. There is documentation that already describes this, what I am adding is:</p>
<ul>
<li>
<p>Use Visual Studio to create project</p>
</li>
<li>
<p>Post Build Events to help create the final XLL file.</p>
</li>
</ul>
<p><strong>NOTE:</strong> <em>I hate Post Build Events.</em> The ONLY exception is in this case where I am modifying the output of the final build. Post Build Events are Evil especially when used in a large development team. A better solutions is to create actual Build Scripts that do what I am about to do. You have been warned.</p>
<p>First, create a new Class Library project. Use NuGet to add a reference to the Excel-DNA package. NuGet will also add ExcelDna.dna and ExcelDna.xll to your project. Rename them both to the name that you want your final output xll to be. In my case I renamed them to Scratch-ExcelDna.dna and Scratch-ExcelDna.xll. Also for both files change to properties for <strong>Build Action</strong> to &ldquo;Content&rdquo; and <strong>Copy to Output Directory</strong> to &ldquo;Copy Always&rdquo;.</p>
<p>Within the packages folder created by NuGet is the ExcelDnaPack utility, in the tools folder. This will package your project into one xll file. For it to work you need to update the .dna file:</p>
<pre tabindex="0"><code>&lt;DnaLibrary RuntimeVersion=&#34;v4.0&#34;&gt;
      &lt;ExternalLibrary Path=&#34;DC.Scratch.ExcelDna.dll&#34; Pack=&#34;true&#34; /&gt;
      &lt;/DnaLibrary&gt;
      
</code></pre><p>Note that I am using .Net 4.</p>
<p>To get the pack utility to work, add a Pre-build event to delete the existing xll:</p>
<p>del &ldquo;$(TargetDir)Scratch-ExcelDna-packed.xll&rdquo;</p>
<p>Then add a Post-build event to recreate it:</p>
<p>&ldquo;$(SolutionDir)packagesExcel-DNA.0.29toolsExcelDnaPack.exe&rdquo; &ldquo;$(TargetDir)Scratch-ExcelDna.dna&rdquo;</p>
<p>While you are in the Project Properties messing with the evil build events set the Debug options so you can test your code. Set the External Program to you MS Excel and add a Command Line argument with a path to your final xll file.</p>
<p>Now, add a class TestFunctions:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> ExcelDna.Integration;  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> DC.Scratch.ExcelDna  
</span></span><span style="display:flex;"><span>{  
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestFunctions</span>  
</span></span><span style="display:flex;"><span>      {  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">            [ExcelFunction(Description = &#34;Product of two numbers&#34;, 
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">                           Category = &#34;DNA Test&#34;)]</span>  
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">double</span> TheProductOf(<span style="color:#66d9ef">double</span> x, <span style="color:#66d9ef">double</span> y)  
</span></span><span style="display:flex;"><span>            {  
</span></span><span style="display:flex;"><span>                  <span style="color:#66d9ef">return</span> x*y;  
</span></span><span style="display:flex;"><span>            }  
</span></span><span style="display:flex;"><span>      }  
</span></span><span style="display:flex;"><span>}  
</span></span></code></pre></div><p>Hit F5 and see if Excel Starts. If it does, add some numbers to the Excel spreadsheet and see if the TheProduct() function works.</p>
<p>Download sample project here: <a href="https://dl.dropboxusercontent.com/u/480457/techshorts/2012/06/DC.Scratch.ExcelDna.zip">DC.Scratch.ExcelDna</a></p>
<p>Microsoft should really look at buying Excel-DNA and incorporating it into Visual Studio. You Guys Listening!?!</p>
<ul class="pa0">
  
   <li class="list di">
     <a href="/tags/.net/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">.Net</a>
   </li>
  
   <li class="list di">
     <a href="/tags/ms-excel/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">MS Excel</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/2012/03/c-spirograph-point-generators.html">C# Spirograph Point Generators</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2011/10/filesystemwatcher-with.html">FileSystemWatcher With the BlockingCollection</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2011/09/running-totals-in-excel_39.html">Running Totals in Excel</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2011/01/scratching-parallel-with-stopwatch.html">Scratching Parallel with StopWatch</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2011/01/simple-mapreduce.html">Simple MapReduce</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2011/01/string-joins.html">String Joins</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2010/12/parsing-delicious-export-file.html">Parsing Delicious Export File</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2010/11/observablecollection-addrange.html">ObservableCollection AddRange</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2010/10/re-microsoft-our-strategy-with.html">RE: Microsoft: Our strategy with Silverlight has shifted | ZDNet</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2010/10/asynchronous-programming-in-c.html">Asynchronous Programming in C#</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2010/10/uow-filehelpers.html">UOW: FileHelpers</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2010/10/threading-autoresetevent-example.html">Threading AutoResetEvent Example</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2010/09/use-linq-and-reflection-to-activate.html">Use Linq and Reflection to Activate Interface and Execute a Method.</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2010/08/infoq-waf-and-caliburn-2-wpf.html">InfoQ: WAF and Caliburn: 2 WPF Application Frameworks</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2009/11/image-to-byte-array.html">Image to Byte Array</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://example.org/" >
    &copy;  Hugo Quick Start Site 2024 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
