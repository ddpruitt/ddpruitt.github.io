<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>MS Access Pivots Part II | Hugo Quick Start Site</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Pivoting a table on multiple columns with a crosstab query gets messy really fast. To eliminate the need for complicated Multiple Value Field Queries you can use the lowly IIF() function and the obscure CHOOSE() function to pivot a table.
Activity Table The table Activity used in this example has the following layout:
AcctID DeptID Class Year BeginBalance Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec The AcctID and DeptID refer to account and department numbers, which are a part of our fictitious company’s accounting key.">
    <meta name="generator" content="Hugo 0.121.2">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="https://example.org/2004/09/ms-access-pivots-part-ii.html">
    

    <meta property="og:title" content="MS Access Pivots Part II" />
<meta property="og:description" content="Pivoting a table on multiple columns with a crosstab query gets messy really fast. To eliminate the need for complicated Multiple Value Field Queries you can use the lowly IIF() function and the obscure CHOOSE() function to pivot a table.
Activity Table The table Activity used in this example has the following layout:
AcctID DeptID Class Year BeginBalance Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec The AcctID and DeptID refer to account and department numbers, which are a part of our fictitious company’s accounting key." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://example.org/2004/09/ms-access-pivots-part-ii.html" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2004-09-25T09:45:00-07:00" />
<meta property="article:modified_time" content="2004-09-25T09:45:00-07:00" />

<meta itemprop="name" content="MS Access Pivots Part II">
<meta itemprop="description" content="Pivoting a table on multiple columns with a crosstab query gets messy really fast. To eliminate the need for complicated Multiple Value Field Queries you can use the lowly IIF() function and the obscure CHOOSE() function to pivot a table.
Activity Table The table Activity used in this example has the following layout:
AcctID DeptID Class Year BeginBalance Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec The AcctID and DeptID refer to account and department numbers, which are a part of our fictitious company’s accounting key."><meta itemprop="datePublished" content="2004-09-25T09:45:00-07:00" />
<meta itemprop="dateModified" content="2004-09-25T09:45:00-07:00" />
<meta itemprop="wordCount" content="1858">
<meta itemprop="keywords" content="SQL Origami," /><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="MS Access Pivots Part II"/>
<meta name="twitter:description" content="Pivoting a table on multiple columns with a crosstab query gets messy really fast. To eliminate the need for complicated Multiple Value Field Queries you can use the lowly IIF() function and the obscure CHOOSE() function to pivot a table.
Activity Table The table Activity used in this example has the following layout:
AcctID DeptID Class Year BeginBalance Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec The AcctID and DeptID refer to account and department numbers, which are a part of our fictitious company’s accounting key."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Hugo Quick Start Site
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">MS Access Pivots Part II</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2004-09-25T09:45:00-07:00">September 25, 2004</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>Pivoting a table on multiple columns with a crosstab query gets messy really fast.  To eliminate the need for complicated Multiple Value Field Queries you can use the lowly IIF() function and the obscure CHOOSE() function to pivot a table.</p>
<h2 id="activity-table">Activity Table</h2>
<p>The table Activity used in this example has the following layout:</p>
<table>
<thead>
<tr>
<th>AcctID</th>
<th>DeptID</th>
<th>Class</th>
<th>Year</th>
<th>BeginBalance</th>
<th>Jan</th>
<th>Feb</th>
<th>Mar</th>
<th>Apr</th>
<th>May</th>
<th>Jun</th>
<th>Jul</th>
<th>Aug</th>
<th>Sep</th>
<th>Oct</th>
<th>Nov</th>
<th>Dec</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>The AcctID and DeptID refer to account and department numbers, which are a part of our fictitious company’s accounting key. The Class refers to the type of monies, in our examples we will stick to only Actual and Budget dollar amounts. The Year is the calendar year in which the values apply. The BeginBalance is the current Year’s beginning balance while the fields Jan through Dec each contain the activity for the given month.</p>
<p>The data in the table was generated using the following criteria:</p>
<ol>
<li>The current calendar year is 1999.</li>
<li>The current accounting period is June.</li>
<li>There are two years of history, so years 1997 and 1998 have actual amounts only.</li>
<li>There is a budget for years 1999 and 2000.</li>
<li>There are no actual amounts for the year 2000, only budget amounts.</li>
</ol>
<h3 id="budget-variance-and-history">Budget Variance and History</h3>
<p>In our first example we will show two techniques of producing a very common accounting scenario: generating a report for a given accounting period showing the comparison between the actual and budgeted amounts, along with history. As an added twist we will show the next years budget also. For this example we will further limit it to show January 1999 as the current accounting period.</p>
<p>The result we produce will need to show the account-department number, January 1997, 1998 and 1999 actual amounts, January 1999 and 2000 budget amounts.</p>
<p>As can be seen, we are pivoting the Actual table on two fields, Year and Class. We will employee several techniques to perform this pivoting to show that there is more than one way to do it. The techniques we will use are:</p>
<ul>
<li>Select query with the IIF( ) function</li>
<li>Select query with a combination of the IIF( ) and CHOOSE( ) functions</li>
</ul>
<h3 id="pivot-using-iif--function">Pivot using IIF( ) Function</h3>
<p>The IIF() function is a built in MS Access function. It is identical to the IF() function in Excel and has the following syntax:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>      IIF( [logical test], [value <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">true</span>], [value <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">false</span>])
</span></span></code></pre></div><p>The logical test can be any type of expression that returns a true or false value.</p>
<p>As a simple example, say we wanted to select the Class field from the Activity table only the word &ldquo;actual&rdquo;. If the Class is &ldquo;actual&rdquo; we want to see &ldquo;Real Dollars&rdquo;, otherwise show &ldquo;Not Real Dollars&rdquo;. To do this we would create the following query:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>      <span style="color:#66d9ef">SELECT</span> Activity.AcctID, Activity.DeptID  
</span></span><span style="display:flex;"><span>      , IIf([<span style="color:#66d9ef">Class</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;actual&#34;</span>,<span style="color:#e6db74">&#34;Real Dollars&#34;</span>,<span style="color:#e6db74">&#34;Not Real Dollars&#34;</span>) <span style="color:#66d9ef">AS</span> RealDollars,
</span></span><span style="display:flex;"><span>            Activity.BeginBalance  
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">FROM</span> Activity;
</span></span></code></pre></div><p>This would return the beginning balances with the either &ldquo;Real Dollars&rdquo; or &ldquo;Not Real Dollars&rdquo; in the RealDollars field. An example output is:</p>
<table>
<thead>
<tr>
<th>AcctID</th>
<th>DeptID</th>
<th>RealDollars</th>
<th>BeginBalance</th>
</tr>
</thead>
<tbody>
<tr>
<td>1000</td>
<td>1000</td>
<td>Real Dollars</td>
<td>$2,530.00</td>
</tr>
<tr>
<td>1000</td>
<td>1000</td>
<td>Real Dollars</td>
<td>$8,690.00</td>
</tr>
<tr>
<td>1000</td>
<td>1000</td>
<td>Real Dollars</td>
<td>$8,235.00</td>
</tr>
<tr>
<td>1000</td>
<td>1000</td>
<td>Real Dollars</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>1000</td>
<td>Not Real Dollars</td>
<td>$5,005.00</td>
</tr>
<tr>
<td>1000</td>
<td>1000</td>
<td>Not Real Dollars</td>
<td>$9,470.00</td>
</tr>
</tbody>
</table>
<p>Now let us turn our attention back to the pivot table problem. The problem is to show for the years 1997 through 1999 the actual dollar amounts (Class = actual), and for the years 1999 and 2000 the budgeted amounts (Class = budget).</p>
<p>Looking at the data, we know that for the years 1997 and 1998 there are no budget amounts. Because of this we can set up two fields in our query using the IIF( ) function and the table field [Year]:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>      [<span style="color:#ae81ff">1997</span>] <span style="color:#f92672">=</span> IIF( [<span style="color:#66d9ef">Year</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1997&#34;</span>, [Jan], <span style="color:#ae81ff">0</span>)  
</span></span><span style="display:flex;"><span>      [<span style="color:#ae81ff">1998</span>] <span style="color:#f92672">=</span> IIF( [<span style="color:#66d9ef">Year</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1998&#34;</span>, [Jan], <span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><p>With these two functions the given query field value will either be the given years January actual amount or zero.</p>
<p>The next two years, 1999 and 2000, have both actual and budget amounts. However, since we are currently in the calendar year 1999 the year 2000 will have only budget amounts. Using this we can create fields for 1999 and 2000:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>      [Actual <span style="color:#ae81ff">1999</span>] <span style="color:#f92672">=</span> IIF([<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1999&#34;</span> <span style="color:#66d9ef">AND</span> [<span style="color:#66d9ef">Class</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;actual&#34;</span>, [Jan], <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>      [Budget <span style="color:#ae81ff">1999</span>] <span style="color:#f92672">=</span> IIF([<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1999&#34;</span> <span style="color:#66d9ef">AND</span> [<span style="color:#66d9ef">Class</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;budget&#34;</span>, [Jan], <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>      [Budget <span style="color:#ae81ff">2000</span>] <span style="color:#f92672">=</span> IIF([<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2000&#34;</span> <span style="color:#66d9ef">AND</span> [<span style="color:#66d9ef">Class</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;budget&#34;</span>, [Jan], <span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><p>These functions will return their indicated values, January Actual 1999, Budget 1999 or Budget 2000, or they will return a zero.</p>
<p>Combining these into a final select query we get:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> act.AcctID, act.DeptID,
</span></span><span style="display:flex;"><span>      IIf([act].[<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1997&#34;</span>,[act].[Jan],<span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">AS</span> <span style="color:#ae81ff">1997</span>, 
</span></span><span style="display:flex;"><span>      IIf([act].[<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1998&#34;</span>,[act].[Jan],<span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">AS</span> <span style="color:#ae81ff">1998</span>, 
</span></span><span style="display:flex;"><span>      IIf([act].[<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1999&#34;</span> <span style="color:#66d9ef">And</span> [act].[<span style="color:#66d9ef">Class</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;actual&#34;</span>,[act].[Jan],<span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">AS</span> Actual1999,
</span></span><span style="display:flex;"><span>      IIf([act].[<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1999&#34;</span> <span style="color:#66d9ef">And</span> [act].[<span style="color:#66d9ef">Class</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;budget&#34;</span>,[act].[Jan],<span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">AS</span> Budget1999,
</span></span><span style="display:flex;"><span>      IIf([act].[<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2000&#34;</span> <span style="color:#66d9ef">And</span> [act].[<span style="color:#66d9ef">Class</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;actual&#34;</span>,[act].[Jan],<span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">AS</span> Actual2000,
</span></span><span style="display:flex;"><span>      IIf([act].[<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2000&#34;</span> <span style="color:#66d9ef">And</span> [act].[<span style="color:#66d9ef">Class</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;budget&#34;</span>,[act].[Jan],<span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">AS</span> Budget2000
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Activity <span style="color:#66d9ef">AS</span> act;
</span></span></code></pre></div><p>As a result for account 1000 we get:</p>
<table>
<thead>
<tr>
<th>AcctID</th>
<th>DeptID</th>
<th>1997</th>
<th>1998</th>
<th>Actual1999</th>
<th>Budget1999</th>
<th>Budget2000</th>
</tr>
</thead>
<tbody>
<tr>
<td>1000</td>
<td>1000</td>
<td>$1,955.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>1000</td>
<td>$0.00</td>
<td>$3,925.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>1000</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$9,195.00</td>
<td>$0.00</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>1000</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>1000</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$3,575.00</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>1000</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$8,470.00</td>
</tr>
<tr>
<td>1000</td>
<td>2000</td>
<td>$8,540.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>2000</td>
<td>$0.00</td>
<td>$8,090.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>2000</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$9,620.00</td>
<td>$0.00</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>2000</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>2000</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$9,980.00</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>2000</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$6,145.00</td>
</tr>
<tr>
<td>1000</td>
<td>2010</td>
<td>$9,285.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>2010</td>
<td>$0.00</td>
<td>$5,510.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>2010</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$1,820.00</td>
<td>$0.00</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>2010</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>2010</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$2,340.00</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>2010</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$0.00</td>
<td>$5,110.00</td>
</tr>
</tbody>
</table>
<p>As you can see there are a lot of zeros. It almost looks like we accomplished the goal of the problem. We have columns with only 1997 values, or 1998 values, or Actual 1999 values, etc, which means we have successfully pivoted on the desired fields, but this result set is quit useless as it is. What we need now is a way to reduce the rows down so that true comparisons can be made between the history and the budget.</p>
<p>This is accomplished by using the aggregate function sum() in the query. Rewriting the query and summing on the amount columns we generate the following select query:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>      act.AcctID, 
</span></span><span style="display:flex;"><span>      act.DeptID, 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">Sum</span>(IIf([act].[<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1997&#34;</span>,[act].[Jan],<span style="color:#ae81ff">0</span>)) <span style="color:#66d9ef">AS</span> <span style="color:#ae81ff">1997</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">Sum</span>(IIf([act].[<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1998&#34;</span>,[act].[Jan],<span style="color:#ae81ff">0</span>)) <span style="color:#66d9ef">AS</span> <span style="color:#ae81ff">1998</span>, 
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">Sum</span>(IIf([act].[<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1999&#34;</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">And</span>[act].[<span style="color:#66d9ef">Class</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;actual&#34;</span>,[act].[Jan],<span style="color:#ae81ff">0</span>)) <span style="color:#66d9ef">AS</span> Actual1999, 
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">Sum</span>(IIf([act].[<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1999&#34;</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">And</span>[act].[<span style="color:#66d9ef">Class</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;budget&#34;</span>,[act].[Jan],<span style="color:#ae81ff">0</span>)) <span style="color:#66d9ef">AS</span> Budget1999, 
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">Sum</span>(IIf([act].[<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2000&#34;</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">And</span>[act].[<span style="color:#66d9ef">Class</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;budget&#34;</span>,[act].[Jan],<span style="color:#ae81ff">0</span>)) <span style="color:#66d9ef">AS</span> Budget2000
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Activity <span style="color:#66d9ef">AS</span> act
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> act.AcctID, act.DeptID;
</span></span></code></pre></div><p>This query returns the results we can use:</p>
<table>
<thead>
<tr>
<th>AcctID</th>
<th>DeptID</th>
<th>1997</th>
<th>1998</th>
<th>Actual1999</th>
<th>Budget1999</th>
<th>Budget2000</th>
</tr>
</thead>
<tbody>
<tr>
<td>1000</td>
<td>1000</td>
<td>$1,955.00</td>
<td>$3,925.00</td>
<td>$9,195.00</td>
<td>$3,575.00</td>
<td>$8,470.00</td>
</tr>
<tr>
<td>1000</td>
<td>2000</td>
<td>$8,540.00</td>
<td>$8,090.00</td>
<td>$9,620.00</td>
<td>$9,980.00</td>
<td>$6,145.00</td>
</tr>
<tr>
<td>1000</td>
<td>2010</td>
<td>$9,285.00</td>
<td>$5,510.00</td>
<td>$1,820.00</td>
<td>$2,340.00</td>
<td>$5,110.00</td>
</tr>
<tr>
<td>1000</td>
<td>2020</td>
<td>$8,460.00</td>
<td>$5,005.00</td>
<td>$8,825.00</td>
<td>$9,000.00</td>
<td>$9,500.00</td>
</tr>
<tr>
<td>1000</td>
<td>3000</td>
<td></td>
<td>$8,355.00</td>
<td>$2,265.00</td>
<td>$6,115.00</td>
<td>$5,050.00</td>
</tr>
<tr>
<td>1000</td>
<td>3010</td>
<td>$6,715.00</td>
<td>$8,665.00</td>
<td>$5,390.00</td>
<td>$695.00</td>
<td>$5,885.00</td>
</tr>
<tr>
<td>1000</td>
<td>4000</td>
<td>$540.00</td>
<td>$9,085.00</td>
<td>$7,775.00</td>
<td>$8,550.00</td>
<td>$8,255.00</td>
</tr>
<tr>
<td>1000</td>
<td>4010</td>
<td>$7,885.00</td>
<td>$1,035.00</td>
<td>$2,870.00</td>
<td>$1,265.00</td>
<td>$5,510.00</td>
</tr>
</tbody>
</table>
<p>By grouping on the AcctID and DeptID and summing on the other columns we have effectively pivoted the table on two columns, [Year] and [Class].</p>
<p>Looking at the first result set (without the sum()) we see that for AcctID 1000, DeptID 1000 there is one row for each non-zero column value (this is assuming that no original value was zero to begin with). What is not seen is the fact that this result is really a snap shot of the original table but without showing the [Year] and [Class] columns, these are hidden in the IIF( ) function.</p>
<p>By comparing the original table (below) to the two above we can see how the values where first pivoted on the [Year] field (first query) then summed to pivot on the [Class] field.</p>
<table>
<thead>
<tr>
<th>AcctID</th>
<th>DeptID</th>
<th>Class</th>
<th>Year</th>
<th>Jan</th>
</tr>
</thead>
<tbody>
<tr>
<td>1000</td>
<td>1000</td>
<td>actual</td>
<td>1997</td>
<td>$1,955.00</td>
</tr>
<tr>
<td>1000</td>
<td>1000</td>
<td>actual</td>
<td>1998</td>
<td>$3,925.00</td>
</tr>
<tr>
<td>1000</td>
<td>1000</td>
<td>actual</td>
<td>1999</td>
<td>$9,195.00</td>
</tr>
<tr>
<td>1000</td>
<td>1000</td>
<td>actual</td>
<td>2000</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>1000</td>
<td>budget</td>
<td>1999</td>
<td>$3,575.00</td>
</tr>
<tr>
<td>1000</td>
<td>1000</td>
<td>budget</td>
<td>2000</td>
<td>$8,470.00</td>
</tr>
<tr>
<td>1000</td>
<td>2000</td>
<td>actual</td>
<td>1997</td>
<td>$8,540.00</td>
</tr>
<tr>
<td>1000</td>
<td>2000</td>
<td>actual</td>
<td>1998</td>
<td>$8,090.00</td>
</tr>
<tr>
<td>1000</td>
<td>2000</td>
<td>actual</td>
<td>1999</td>
<td>$9,620.00</td>
</tr>
<tr>
<td>1000</td>
<td>2000</td>
<td>actual</td>
<td>2000</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>2000</td>
<td>budget</td>
<td>1999</td>
<td>$9,980.00</td>
</tr>
<tr>
<td>1000</td>
<td>2000</td>
<td>budget</td>
<td>2000</td>
<td>$6,145.00</td>
</tr>
<tr>
<td>1000</td>
<td>2010</td>
<td>actual</td>
<td>1997</td>
<td>=right&gt;$9,285.00</td>
</tr>
<tr>
<td>1000</td>
<td>2010</td>
<td>actual</td>
<td>1998</td>
<td>$5,510.00</td>
</tr>
<tr>
<td>1000</td>
<td>2010</td>
<td>actual</td>
<td>1999</td>
<td>$1,820.00</td>
</tr>
<tr>
<td>1000</td>
<td>2010</td>
<td>actual</td>
<td>2000</td>
<td>$0.00</td>
</tr>
<tr>
<td>1000</td>
<td>2010</td>
<td>budget</td>
<td>1999</td>
<td>$2,340.00</td>
</tr>
<tr>
<td>1000</td>
<td>2010</td>
<td>budget</td>
<td>2000</td>
<td>$5,110.00</td>
</tr>
</tbody>
</table>
<p>Also, note that this was a single select query as opposed to the use of two crosstabs combined in a select query.</p>
<h3 id="pivot-using-iif--and-choose--functions">Pivot Using IIF( ) and CHOOSE( ) Functions</h3>
<p>From the previous examples we see how to pivot a table on two columns. In all cases though, we were only able to show data for one accounting period, January. In order to show any of the other months activity using the above techniques we would have to create eleven more queries. Maintaining twelve queries, which only shows the data in one way is very cumbersome and over time as the number of reports needed increased, impossible to maintain.</p>
<p>The solution would be to write a single query with a parameter to be used in all twelve cases. The parameter would be the number of the month whose values we want to see. If we were to stay with just using the IIF( ) function our query would have fields like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>[<span style="color:#ae81ff">1997</span>] <span style="color:#f92672">=</span> IIF([<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1999&#34;</span>, (
</span></span><span style="display:flex;"><span>            IIF([<span style="color:#66d9ef">Month</span>]<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, [JAN], (  
</span></span><span style="display:flex;"><span>            IIF([<span style="color:#66d9ef">Month</span>]<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, [FEB], <span style="color:#960050;background-color:#1e0010">…</span><span style="color:#ae81ff">0</span>) <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><p>This again would be impossible to maintain.</p>
<p>The alternative is to use the CHOOSE() function. The syntax is:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span> Choose (<span style="color:#66d9ef">index</span>, choice<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>[, choice<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, ... [, choice<span style="color:#f92672">-</span>n]])
</span></span></code></pre></div><p>Where index refers to the choice number. If index equals 1 then choice-1 is returned, if it is 2 then choice-2 is returned, on down to index equal n then choice-n is returned.</p>
<p>Using our parameter we can rewrite the above function as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span> [<span style="color:#ae81ff">1997</span>] <span style="color:#f92672">=</span> IIF([<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1997&#34;</span>, Choose([<span style="color:#66d9ef">Month</span>], [JAN], [FEB], <span style="color:#960050;background-color:#1e0010">…</span>,[DEC]), <span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><p>with all twelve months listed in the single Choose() function. This is easier to understand and maintain. When the query is executed we are asked for a month and the correct values are returned.</p>
<p>The select query would look like the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">PARAMETERS</span> MonthNum Short;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>      act.AcctID,
</span></span><span style="display:flex;"><span>      act.DeptID, 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">Sum</span>(IIf([act].[<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1997&#34;</span>, 
</span></span><span style="display:flex;"><span>      Choose([MonthNum]
</span></span><span style="display:flex;"><span>      ,[act].[Jan],[act].[Feb],[act].[Mar] ,[act].[Apr],[act].[May],[act].[Jun]
</span></span><span style="display:flex;"><span>      ,[act].[Jul],[act].[Aug],[act].[Sep] ,[act].[Oct],[act].[Nov],[act].[Dec]),<span style="color:#ae81ff">0</span>)) <span style="color:#66d9ef">AS</span> <span style="color:#ae81ff">1997</span>,
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">Sum</span>(IIf([act].[<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1998&#34;</span>, 
</span></span><span style="display:flex;"><span>            Choose([MonthNum] ,[act].[Jan],[act].[Feb],[act].[Mar]
</span></span><span style="display:flex;"><span>            ,[act].[Apr],[act].[May],[act].[Jun] ,[act].[Jul],[act].[Aug],[act].[Sep]
</span></span><span style="display:flex;"><span>            ,[act].[Oct],[act].[Nov],[act].[Dec]),<span style="color:#ae81ff">0</span>)) <span style="color:#66d9ef">AS</span> <span style="color:#ae81ff">1998</span>, 
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">Sum</span>(IIf([act].[<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1999&#34;</span> <span style="color:#66d9ef">And</span> [act].[<span style="color:#66d9ef">Class</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;actual&#34;</span>, 
</span></span><span style="display:flex;"><span>            Choose([MonthNum] ,[act].[Jan],[act].[Feb],[act].[Mar]
</span></span><span style="display:flex;"><span>            ,[act].[Apr],[act].[May],[act].[Jun] ,[act].[Jul],[act].[Aug],[act].[Sep]
</span></span><span style="display:flex;"><span>            ,[act].[Oct],[act].[Nov],[act].[Dec]),<span style="color:#ae81ff">0</span>)) <span style="color:#66d9ef">AS</span> Actual1999, 
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">Sum</span>(IIf([act].[<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1999&#34;</span> <span style="color:#66d9ef">And</span> [act].[<span style="color:#66d9ef">Class</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;budget&#34;</span>, 
</span></span><span style="display:flex;"><span>            Choose([MonthNum] ,[act].[Jan],[act].[Feb],[act].[Mar]
</span></span><span style="display:flex;"><span>            ,[act].[Apr],[act].[May],[act].[Jun] ,[act].[Jul],[act].[Aug],[act].[Sep]
</span></span><span style="display:flex;"><span>            ,[act].[Oct],[act].[Nov],[act].[Dec]),<span style="color:#ae81ff">0</span>)) <span style="color:#66d9ef">AS</span> Budget1999, 
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">Sum</span>(IIf([act].[<span style="color:#66d9ef">Year</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2000&#34;</span> <span style="color:#66d9ef">And</span> [act].[<span style="color:#66d9ef">Class</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;budget&#34;</span>, 
</span></span><span style="display:flex;"><span>            Choose([MonthNum] ,[act].[Jan],[act].[Feb],[act].[Mar]
</span></span><span style="display:flex;"><span>            ,[act].[Apr],[act].[May],[act].[Jun] ,[act].[Jul],[act].[Aug],[act].[Sep]
</span></span><span style="display:flex;"><span>            ,[act].[Oct],[act].[Nov],[act].[Dec]),<span style="color:#ae81ff">0</span>)) <span style="color:#66d9ef">AS</span> Budget2000
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> Activity <span style="color:#66d9ef">AS</span> act
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> act.AcctID, act.DeptID;
</span></span></code></pre></div><p>Note that we still need to use the sum() aggregate function for the query to return the correct results. When we execute the query we are asked for the parameter value for MonthNum. The results for a MonthNum of 1 (January) are:</p>
<table>
<thead>
<tr>
<th>AcctID</th>
<th>DeptID</th>
<th>1997</th>
<th>1998</th>
<th>Actual1999</th>
<th>Budget1999</th>
<th>Budget2000</th>
</tr>
</thead>
<tbody>
<tr>
<td>1000</td>
<td>1000</td>
<td>$1,955.00</td>
<td>$3,925.00</td>
<td>$9,195.00</td>
<td>$3,575.00</td>
<td>$8,470.00</td>
</tr>
<tr>
<td>1000</td>
<td>2000</td>
<td>$8,540.00</td>
<td>$8,090.00</td>
<td>$9,620.00</td>
<td>$9,980.00</td>
<td>$6,145.00</td>
</tr>
<tr>
<td>1000</td>
<td>2010</td>
<td>$9,285.00</td>
<td>$5,510.00</td>
<td>$1,820.00</td>
<td>$2,340.00</td>
<td>$5,110.00</td>
</tr>
<tr>
<td>1000</td>
<td>2020</td>
<td>$8,460.00</td>
<td>$5,005.00</td>
<td>$8,825.00</td>
<td>$9,000.00</td>
<td></td>
</tr>
<tr>
<td>1000</td>
<td>3000</td>
<td>$4,605.00</td>
<td>$8,355.00</td>
<td>$2,265.00</td>
<td>$6,115.00</td>
<td>$5,050.00</td>
</tr>
<tr>
<td>1000</td>
<td>3010</td>
<td>$6,715.00</td>
<td>$8,665.00</td>
<td>$5,390.00</td>
<td>$695.00</td>
<td>$5,885.00</td>
</tr>
<tr>
<td>1000</td>
<td>4000</td>
<td>$540.00</td>
<td>$9,085.00</td>
<td>$7,775.00</td>
<td>$8,550.00</td>
<td>$8,255.00</td>
</tr>
<tr>
<td>1000</td>
<td>4010</td>
<td>$7,885.00</td>
<td>$1,035.00</td>
<td>$2,870.00</td>
<td>$1,265.00</td>
<td>$5,510.00</td>
</tr>
</tbody>
</table>
<p>This result set matches the previous results as expected. If they had not then we would have known that this technique would not work. And if we need to see the values for any other month we would enter that month number into the parameter.</p>
<ul class="pa0">
  
   <li class="list di">
     <a href="/tags/sql-origami/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">SQL Origami</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/2004/09/ms-access-pivots-part-i.html">MS Access Pivots Part I</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2004/01/period-matirx-twisting.html">Period Matirx Twisting</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://example.org/" >
    &copy;  Hugo Quick Start Site 2024 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
