<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Remote Controlled RoboTank | Hugo Quick Start Site</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="This is my version of the ever popular to build RoboTank. It uses an Arduino Mega 2560 with the AdaFruit motor shield and an XBee S1 to communicate to the DFRobot Gamepad. The sketch for the RoboTank makes use of the AFMotor.h to drive the motors and includes a serial parser to read and process the commands coming from the Gamepad.
Robotank-Sketch.zip
DFRobot Wireless Joystick
Item Model Source Unit Price Quantity Cost DFRduino Mega 2560 (Arduino Mega Compatible) DFR0127 DFRobot $35.">
    <meta name="generator" content="Hugo 0.121.2">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="https://example.org/2013/08/remote-controlled-robotank_99.html">
    

    <meta property="og:title" content="Remote Controlled RoboTank" />
<meta property="og:description" content="This is my version of the ever popular to build RoboTank. It uses an Arduino Mega 2560 with the AdaFruit motor shield and an XBee S1 to communicate to the DFRobot Gamepad. The sketch for the RoboTank makes use of the AFMotor.h to drive the motors and includes a serial parser to read and process the commands coming from the Gamepad.
Robotank-Sketch.zip
DFRobot Wireless Joystick
Item Model Source Unit Price Quantity Cost DFRduino Mega 2560 (Arduino Mega Compatible) DFR0127 DFRobot $35." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://example.org/2013/08/remote-controlled-robotank_99.html" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2013-08-15T05:02:00-07:00" />
<meta property="article:modified_time" content="2013-08-15T05:02:00-07:00" />

<meta itemprop="name" content="Remote Controlled RoboTank">
<meta itemprop="description" content="This is my version of the ever popular to build RoboTank. It uses an Arduino Mega 2560 with the AdaFruit motor shield and an XBee S1 to communicate to the DFRobot Gamepad. The sketch for the RoboTank makes use of the AFMotor.h to drive the motors and includes a serial parser to read and process the commands coming from the Gamepad.
Robotank-Sketch.zip
DFRobot Wireless Joystick
Item Model Source Unit Price Quantity Cost DFRduino Mega 2560 (Arduino Mega Compatible) DFR0127 DFRobot $35."><meta itemprop="datePublished" content="2013-08-15T05:02:00-07:00" />
<meta itemprop="dateModified" content="2013-08-15T05:02:00-07:00" />
<meta itemprop="wordCount" content="1061">
<meta itemprop="keywords" content="Arduino," /><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Remote Controlled RoboTank"/>
<meta name="twitter:description" content="This is my version of the ever popular to build RoboTank. It uses an Arduino Mega 2560 with the AdaFruit motor shield and an XBee S1 to communicate to the DFRobot Gamepad. The sketch for the RoboTank makes use of the AFMotor.h to drive the motors and includes a serial parser to read and process the commands coming from the Gamepad.
Robotank-Sketch.zip
DFRobot Wireless Joystick
Item Model Source Unit Price Quantity Cost DFRduino Mega 2560 (Arduino Mega Compatible) DFR0127 DFRobot $35."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Hugo Quick Start Site
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">Remote Controlled RoboTank</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2013-08-15T05:02:00-07:00">August 15, 2013</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p><a href="/wp-content/uploads/2013/08/TankAndController01.jpg"><img src="https://dl.dropboxusercontent.com/u/480457/techshorts/2013/08/_d_improd_/TankAndController01_f_improf_672x400.jpg" alt="RoboTank and Gamepad"></a></p>
<p>This is my version of the ever popular to build RoboTank. It uses an Arduino Mega 2560 with the AdaFruit motor shield and an XBee S1 to communicate to the DFRobot Gamepad. The sketch for the RoboTank makes use of the AFMotor.h to drive the motors and includes a serial parser to read and process the commands coming from the Gamepad.</p>
<p><a href="./wp-content/uploads/2013/08/RoboTank-Sketch.zip">Robotank-Sketch.zip</a><br>
<a href="./2013/08/dfrobot-wireless-joystick-1-1-dfr0182/" title="DFRobot Wireless Joystick 1.1 (DFR0182)">DFRobot Wireless Joystick</a></p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Model</th>
<th>Source</th>
<th>Unit Price</th>
<th>Quantity</th>
<th>Cost</th>
</tr>
</thead>
<tbody>
<tr>
<td>DFRduino Mega 2560 (Arduino Mega Compatible)</td>
<td>DFR0127</td>
<td>DFRobot</td>
<td>$35.00</td>
<td>1</td>
<td>$35.00</td>
</tr>
<tr>
<td>Mega IO Expansion Shield V2.1 For Arduino Mega</td>
<td>DFR0165</td>
<td>DFRobot</td>
<td>$19.50</td>
<td>1</td>
<td>$19.50</td>
</tr>
<tr>
<td><a href="/2013/08/dfrobot-wireless-joystick-1-1-dfr0182">Wireless GamePad for Arduino</a></td>
<td>DFR0182</td>
<td>DFR0182</td>
<td>$57.50</td>
<td>1</td>
<td>$57.50</td>
</tr>
<tr>
<td>USB Serial Light Adapter (Arduino Compatible)</td>
<td>DFR0164</td>
<td>DFRobot</td>
<td>$12.50</td>
<td>1</td>
<td>$12.50</td>
</tr>
<tr>
<td>XBee 1mW Wire Antenna (S1)</td>
<td>TEL0014</td>
<td>DFRobot</td>
<td>$23.50</td>
<td>2</td>
<td>$47.00</td>
</tr>
<tr>
<td>XBee Explorer USB</td>
<td>WRL-08687</td>
<td>SparkFun</td>
<td>$24.95</td>
<td>2</td>
<td>$49.90</td>
</tr>
<tr>
<td>Adafruit Motor Shield for Arduino</td>
<td></td>
<td>Amazon</td>
<td>$22.50</td>
<td>1</td>
<td>$22.50</td>
</tr>
<tr>
<td>Tamiya 70108 Tracked Vehicle Chassis</td>
<td></td>
<td>Amazon</td>
<td>$18.40</td>
<td>1</td>
<td>$18.40</td>
</tr>
<tr>
<td>Tamiya Universal Plate TAM70098</td>
<td></td>
<td>Amazon</td>
<td>$6.67</td>
<td>1</td>
<td>$6.67</td>
</tr>
<tr>
<td>Tamiya 70168 Double Gearbox L/R Independ 4-Speed</td>
<td></td>
<td>Amazon</td>
<td>$8.80</td>
<td>1</td>
<td>$8.80</td>
</tr>
</tbody>
</table>
<p><a href="/wp-content/uploads/2013/08/TankArduino01.jpg"><img src="https://dl.dropboxusercontent.com/u/480457/techshorts/2013/08/_d_improd_/TankArduino01_f_improf_665x525.jpg" alt="RoboTank Arduino"></a></p>
<p>The Arduino is powered by a 9V battery floating under the top plate and the motors are powered by a four cell &ldquo;AA&rdquo; battery pack velcroed to the bottom behind the motors. Separating the power like this is important as the current draw by the motors could impact the performance of the Arduino. If both the motors and the Arduino used the same power supply you would see sporadic bugs and difficult to trace issues with your code, so you would think. So remember: Separation of Powers.</p>
<p>The switch is used to turn on and off the power to the motors. Unplugging the 9V battery turns off the Arduino.</p>
<p><a href="/wp-content/uploads/2013/08/TankArduino02.jpg"><img src="https://dl.dropboxusercontent.com/u/480457/techshorts/2013/08/_d_improd_/TankArduino02_f_improf_661x322.jpg" alt="RoboTank Arduino"></a></p>
<p>The <a href="http://www.dfrobot.com/wiki/index.php/Mega_IO_Expansion_Shield_V2(SKU:DFR0165)">Mega IO Expansion Shield</a> was used for the same reason I used the Mega 2560 Arduino: I had them. The Mega 2560 has three serial IO&rsquo;s which allowed for the XBee to be installed on Serial1 and still monitor Serial when programming the sketch.</p>
<p><a href="/wp-content/uploads/2013/08/dfrobot-mega-io-shield.jpg"><img src="https://dl.dropboxusercontent.com/u/480457/techshorts/2013/08/_d_improd_/dfrobot-mega-io-shield_f_improf_352x352.jpg" alt="Mega IO Expansion Shield"></a></p>
<p>The <a href="http://learn.adafruit.com/adafruit-motor-shield">Adafruit motor shield</a> was used since it is the most popular.</p>
<p><a href="/wp-content/uploads/2013/08/adafruit-motor-shield.jpg"><img src="https://dl.dropboxusercontent.com/u/480457/techshorts/2013/08/_d_improd_/adafruit-motor-shield_f_improf_476x357.jpg" alt="Adafruit Motor Shield"></a></p>
<p>For the Serial communication I borrowed heavily from <a href="http://jhaskellsblog.blogspot.com.ar/2011/05/serial-comm-fundamentals-on-arduino.html">Serial Comm Fundamentals on Arduino</a>. Borrowed heavily means &ldquo;liberally used&rdquo; his serial code.</p>
<p>Notice though that I am reading from Serial1 since the XBee is plugged into the Serial1 headers.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">//buffer size for NMEA compliant GPS string  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define DATABUFFERSIZE 80  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">char</span> dataBuffer[DATABUFFERSIZE <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]; <span style="color:#75715e">//Add 1 for NULL terminator  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>byte dataBufferIndex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>boolean <span style="color:#a6e22e">getSerialString</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> byte dataBufferIndex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (Serial1.<span style="color:#a6e22e">available</span>() <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">char</span> incomingbyte <span style="color:#f92672">=</span> Serial1.<span style="color:#a6e22e">read</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (incomingbyte <span style="color:#f92672">==</span> startChar)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            dataBufferIndex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//Initialize our dataBufferIndex variable  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            storeString <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (storeString)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//Let&#39;s check our index here, and abort if we&#39;re outside our buffer size  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#75715e">//We use our define here so our buffer size can be easily modified  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (dataBufferIndex <span style="color:#f92672">==</span> DATABUFFERSIZE)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//Oops, our index is pointing to an array element outside our buffer.  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                dataBufferIndex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>                storeString <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (incomingbyte <span style="color:#f92672">==</span> endChar)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                dataBuffer[dataBufferIndex] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//null terminate the C string  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                storeString <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//Our data string is complete. return true  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">return</span> true;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                dataBuffer[dataBufferIndex<span style="color:#f92672">++</span>] <span style="color:#f92672">=</span> incomingbyte;
</span></span><span style="display:flex;"><span>                dataBuffer[dataBufferIndex] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">//null terminate the C string  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            dataBuffer[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>            storeString <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>            dataBufferIndex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//We&#39;ve read in all the available Serial data, and don&#39;t have a valid string yet, so return false  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> false;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I also borrowed heavily from the same blog the <a href="http://jhaskellsblog.blogspot.com.ar/2011/06/parsing-quick-guide-to-strtok-there-are.html">Parsing: Quick guide to strtok()</a>. In this case there are only two parts to my &ldquo;phoNMEA&rdquo; strings: $CommandName: Value; so parsing was easy. The command name and value are stored in the gamePadCommand array.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">char</span> startChar <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;$&#39;</span>; <span style="color:#75715e">// or &#39;!&#39;, or whatever your start character is  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">char</span> endChar <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;r&#39;</span>;
</span></span><span style="display:flex;"><span>boolean storeString <span style="color:#f92672">=</span> false; <span style="color:#75715e">//This will be our flag to put the data in our buffer  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">char</span> delimiters[] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;$: ;&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">char</span> gamePadCommand[<span style="color:#ae81ff">2</span>][DATABUFFERSIZE<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] ;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">parseNmea</span>(<span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> nmea, <span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> delimiters)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>gamePadCommand[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;0&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>gamePadCommand[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;0&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> curPosition;
</span></span><span style="display:flex;"><span>    curPosition <span style="color:#f92672">=</span> <span style="color:#a6e22e">strtok</span>(nmea, delimiters);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (curPosition <span style="color:#f92672">==</span> NULL) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">strcpy</span>(gamePadCommand[<span style="color:#ae81ff">0</span>], curPosition);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    curPosition <span style="color:#f92672">=</span> <span style="color:#a6e22e">strtok</span>(NULL, delimiters);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (curPosition <span style="color:#f92672">==</span> NULL) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">strcpy</span>(gamePadCommand[<span style="color:#ae81ff">1</span>], curPosition);  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>}  
</span></span></code></pre></div><p>I initially tried to use a series of <strong>if</strong> statements to process the commands from the gamepad but I ran into a problem with the size of the sketch.  I had a bunch of test code in the sketch and kept adding and adding for more tests until at some point it failed to compile.  It gave a weird error message I couldn&rsquo;t figure out until I realized that as I removed code it suddenly started to compile.  I wound up removing the <strong>if</strong> statements and used function pointers instead, which actually worked better.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> commands[<span style="color:#ae81ff">7</span>] <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#34;BTN&#34;</span>, <span style="color:#e6db74">&#34;LJSY&#34;</span>, <span style="color:#e6db74">&#34;LJSX&#34;</span>, <span style="color:#e6db74">&#34;RJSY&#34;</span>, <span style="color:#e6db74">&#34;RJSX&#34;</span>, <span style="color:#e6db74">&#34;LTRG&#34;</span>, <span style="color:#e6db74">&#34;LTRG&#34;</span> };  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> (<span style="color:#f92672">*</span>commandFunction[<span style="color:#ae81ff">7</span>])() <span style="color:#f92672">=</span> {    handleButton,  
</span></span><span style="display:flex;"><span>                                    handleJoystick, handleJoystick,  
</span></span><span style="display:flex;"><span>                                    handleJoystick, handleJoystick,  
</span></span><span style="display:flex;"><span>                                    handleTrigger, handleTrigger};  
</span></span><span style="display:flex;"><span>  
</span></span></code></pre></div><p>In the <strong>loop()</strong> function I had to loop through each command name until I found the right command to execute:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">loop</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">getSerialString</span>())
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//Serial.println(dataBuffer);  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">parseNmea</span>(dataBuffer, delimiters);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">7</span>; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//Serial.print(gamePadCommand[0]),Serial.print(&#34; : &#34;),Serial.println(commands[i]);  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">0</span>], commands[i]) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                commandFunction[i]();
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">delay</span>(<span style="color:#ae81ff">10</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The primary commands used are the joystick XY commands. The Left Joystick ($LJSY) controls the Left Track on the tank and conversely the Right Joystick ($RJSY) controls the Right Track. The X values are not currently used.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">handleJoystick</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">0</span>], <span style="color:#e6db74">&#34;RJSX&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">||</span> (<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">0</span>], <span style="color:#e6db74">&#34;LJSX&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> jsValue;
</span></span><span style="display:flex;"><span>    jsValue <span style="color:#f92672">=</span> <span style="color:#a6e22e">atoi</span>(gamePadCommand[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint8_t</span> directionToGo;
</span></span><span style="display:flex;"><span>    directionToGo <span style="color:#f92672">=</span> jsValue <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> FORWARD : BACKWARD;
</span></span><span style="display:flex;"><span>    jsValue <span style="color:#f92672">=</span> <span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">abs</span>(jsValue), <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">500</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">255</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ((<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">0</span>], <span style="color:#e6db74">&#34;RJSY&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        rightMotor.<span style="color:#a6e22e">run</span>(directionToGo);
</span></span><span style="display:flex;"><span>        rightMotor.<span style="color:#a6e22e">setSpeed</span>(jsValue);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ((<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">0</span>], <span style="color:#e6db74">&#34;LJSY&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        leftMotor.<span style="color:#a6e22e">run</span>(directionToGo);
</span></span><span style="display:flex;"><span>        leftMotor.<span style="color:#a6e22e">setSpeed</span>(jsValue);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Serial.<span style="color:#a6e22e">print</span>(gamePadCommand[<span style="color:#ae81ff">0</span>]), Serial.<span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34; : &#34;</span>), Serial.<span style="color:#a6e22e">println</span>(jsValue);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Currently I am not using any of the buttons on the gamepad, I intended for the D-pad to do simple Forward / Back / Turn Left / Turn Right commands but I haven&rsquo;t completed that yet. The code is there but the Joystick code seems to overwrite my results.</p>
<p>Also I should convert the <strong>if</strong> statements to function pointers as well.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">handleButton</span>() {  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#34;S1&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#34;S2&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#34;Y&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#34;X&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) { <span style="color:#a6e22e">allStop</span>(); <span style="color:#66d9ef">return</span>; }  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#34;B&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#34;A&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#34;WHITE&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#34;BLACK&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#34;UP&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) { <span style="color:#a6e22e">goForward</span>(); <span style="color:#66d9ef">return</span>; }  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#34;LEFT&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) { <span style="color:#a6e22e">pivotLeft</span>(); <span style="color:#66d9ef">return</span>; }  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#34;DOWN&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) { <span style="color:#a6e22e">goBack</span>(); <span style="color:#66d9ef">return</span>; }  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#34;RIGHT&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) { <span style="color:#a6e22e">pivotRight</span>(); <span style="color:#66d9ef">return</span>; }  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#34;BACK&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span>;  
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(gamePadCommand[<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#34;START&#34;</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">return</span>;  
</span></span><span style="display:flex;"><span>}  
</span></span></code></pre></div><p><a href="https://www.youtube.com/watch?v=ePgOea3PeyY">https://www.youtube.com/watch?v=ePgOea3PeyY</a></p>
<ul class="pa0">
  
   <li class="list di">
     <a href="/tags/arduino/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Arduino</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/2013/08/dfrobot-wireless-joystick-11-dfr0182_13.html">DFRobot Wireless Joystick 1.1 (DFR0182)</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://example.org/" >
    &copy;  Hugo Quick Start Site 2024 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
