<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>SQL Moment of Clairity | Hugo Quick Start Site</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="I was working on a stored procedure the other day, not one that I wrote originally but one that was causing performance issues in out system. The procedure was taking any where from 40 to 60 seconds to run, which is unacceptable in a web service. This in fact was causing the web service to time out.
An inspection of the execution plan showed that one part of the procedure was doing an index scan and that it was this that was taking up over 85% of the execution time.">
    <meta name="generator" content="Hugo 0.121.2">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="https://example.org/2006/10/sql-moment-of-clairity.html">
    

    <meta property="og:title" content="SQL Moment of Clairity" />
<meta property="og:description" content="I was working on a stored procedure the other day, not one that I wrote originally but one that was causing performance issues in out system. The procedure was taking any where from 40 to 60 seconds to run, which is unacceptable in a web service. This in fact was causing the web service to time out.
An inspection of the execution plan showed that one part of the procedure was doing an index scan and that it was this that was taking up over 85% of the execution time." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://example.org/2006/10/sql-moment-of-clairity.html" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2006-10-17T12:16:00-07:00" />
<meta property="article:modified_time" content="2006-10-17T12:16:00-07:00" />

<meta itemprop="name" content="SQL Moment of Clairity">
<meta itemprop="description" content="I was working on a stored procedure the other day, not one that I wrote originally but one that was causing performance issues in out system. The procedure was taking any where from 40 to 60 seconds to run, which is unacceptable in a web service. This in fact was causing the web service to time out.
An inspection of the execution plan showed that one part of the procedure was doing an index scan and that it was this that was taking up over 85% of the execution time."><meta itemprop="datePublished" content="2006-10-17T12:16:00-07:00" />
<meta itemprop="dateModified" content="2006-10-17T12:16:00-07:00" />
<meta itemprop="wordCount" content="299">
<meta itemprop="keywords" content="SQL Origami," /><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="SQL Moment of Clairity"/>
<meta name="twitter:description" content="I was working on a stored procedure the other day, not one that I wrote originally but one that was causing performance issues in out system. The procedure was taking any where from 40 to 60 seconds to run, which is unacceptable in a web service. This in fact was causing the web service to time out.
An inspection of the execution plan showed that one part of the procedure was doing an index scan and that it was this that was taking up over 85% of the execution time."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Hugo Quick Start Site
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">SQL Moment of Clairity</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2006-10-17T12:16:00-07:00">October 17, 2006</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>I was working on a stored procedure the other day, not one that I wrote originally but one that was causing performance issues in out system. The procedure was taking any where from 40 to 60 seconds to run, which is unacceptable in a web service. This in fact was causing the web service to time out.</p>
<p>An inspection of the execution plan showed that one part of the procedure was doing an index scan and that it was this that was taking up over 85% of the execution time. I was totally baffled, it was hitting the index so why wasn’t it faster?</p>
<p>Then I learned three things all at once:</p>
<ul>
<li>Implicit Conversion</li>
<li>non-sargable kills performance</li>
<li>Index Seek is preferred of Index Scan</li>
</ul>
<p><strong>Implicit Conversion</strong></p>
<p>In the stored proc a variable was defined as an NVARCHAR(20) but the field in the table it was being compared to was a CHAR(10). This lead to an implicit conversion of the variable to a CHAR(10), which lead into the next issue:</p>
<p><strong>Non-Sargable Kills Performance</strong></p>
<p>Sargable refers to the pseudo-acronym “SARG” – Search ARGument and refers to a WHERE clause that compares a constant value to a column value. The implicit conversion was causing a non-SARGable condition which means the WHERE clause cannot use an index.</p>
<p><strong>Index Scan</strong></p>
<p>Because of the non-sargable condition an Index Scan was being performed. An Index Scan is just as bad as a Table Scan in the SQL realm and should be avoided at all costs.</p>
<p>The solution was simple: Change the variable to a CHAR(10). After doing that the Index Scan became an Index Seek and the whole stored procedure returned in less than a second. Any time I see an order of magnitude improvement like that from one simple change it just boggles my mind.</p>
<ul class="pa0">
  
   <li class="list di">
     <a href="/tags/sql-origami/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">SQL Origami</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/2006/04/sqlassist-sql-intellisense.html">SqlAssist, SQL Intellisense</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2004/09/period-matrix.html">Period Matrix</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2004/09/ms-access-pivots-part-ii.html">MS Access Pivots Part II</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2004/09/ms-access-pivots-part-i.html">MS Access Pivots Part I</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/2004/01/period-matirx-twisting.html">Period Matirx Twisting</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://example.org/" >
    &copy;  Hugo Quick Start Site 2024 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
